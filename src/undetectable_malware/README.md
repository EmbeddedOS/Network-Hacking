# Undetectable malware program in C

- Target machine is updated window 10.

## What does this program do?

- Connection with our server.
- Create a shell and wait for incoming command and iterate over certain options.
- Automatically start program when machine is rebooted.
- Start and spawn other programs.
- Navigating through different directories.
- Run key-logger to our backdoor.
- Open Windows box to message to users.

## How the user start our malware?

- We have many ways to do this, for example, we can install our program as a image file with extensions: `.jpg`, `.png`.
- The user have no idea from where they would like came from. The click to `.jpg` image, which will open up an image, everything will look normally. Even if they close it, nothing will be shown on the desktop or anywhere. They have no idea that jut by opening this image, they have started our malware.

- And after the malware running, in our server we established the connection with Windows 10 target machine. After that, we can run any command: windows command prompt, etc.
- And one more thing we can do, start our key-logger. And our key-logger will capture all of the keystrokes that the target inputs in their keyboard (every account, facebook, instagram, etc.).

## How to make an executable file transform any other file type (jpg, pdf, mp4, etc.)

- How you can convert any file to look exactly like an image?
  - We will using the WinRAR tool for that.

1. Get a image from somewhere (jpeg, png, etc) for example: test.png.
2. Go to the browser convert the image to `ico` format.
   1. Upload.
   2. Select icon format.
   3. convert and download.
3. Now, we have three files: image, icon for the image, and executable file.
4. Select image file and executable file. right click -> add to archive...
   1. We need to change some option.
   2. In general:
      1. Change name to the name with extension you want: test.png
      2. Click option: `Create SFX archive`
   3. In Advantaged:
      1. SFX options -> Setup -> In `Run after extraction` box:
         1. First program we will run is open the image we write: test.png
         2. Next we run our program: malware.exe
         In the box content like this:

         ```text
         test.png
         malware.exe
         ```

      2. SFX options -> Modes -> check `unlock to temporary folder`.
      3. SFX options -> Modes -> Silent mode -> Hide all.
      4. SFX options -> Text and icon -> Load SFX icon from the file: select our icon file.
      5. SFX options -> Update -> Select 2 checks:
         1. Extract and update files.
         2. Overwrite all files.

## Dependency library

## Build our programs

- Building the backdoor on window:

```sh
g++.exe .\backdoor.cc -lws2_32
```

- Building the backdoor on Linux:

```sh
i686-w64-mingw32-g++ backdoor.cc -lwsock32 -lwininet
```

- Building the server on Linux:

```sh
g++ server.ccs
```

## Setup our program automatically boot when window start

- We use Windows Registry Editor:
  - It is database of windows system.
  - key-value structure.
  - To open: Windows + R: regedit

- There is a certain part of this register where if you add a registry value for a specific program, it will let that program run every time you restart the PC without click to turn on.

- And that part of the registry is located at this path: `Computer\HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\Run`

- This exact path is exactly what we are going to store our program registry key in order to run it every time automatically at reboot.

- So, we will create a registry key that is going to be stored at this location in order to actually enable us to run our program automatically at reboot.

## Key-logger

- The goal is to actually run the key logger in the background and still be able to execute other commands simultaneously.
