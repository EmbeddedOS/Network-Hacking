# Exploit Development for Linux (x86)

- Exploiting binaries that are written for x86 architecture.
- What will we do?
  - Writing shell code (Exit, Execve, Reverse TCP, etc.) using x86 assembly.
  - Implement techniques which exploit Vanilla Buffer overflows.
  - Identifying bad characters.
  - Debugging with GDB & GEF.
  - Bypassing NX (using Ret2Libc) & ASLR (using Bruteforce).
  - Return Oriented Programming.

- Install tools: NETCAT, GDB, GEF, NASM, LD, HEXDUMP, ROPPER.

```bash
bash -c "$(curl -fsSL https://gef.blah.cat/sh)"
```

## x86 Assembly fundamentals

### Registers

```text
|<---------------------------------64 bits------------------------------>|
|                                   RAX                                  |
                                     |<-------------32 bits------------->|
                                     |                EAX                |
                                                       |        AX       |
                                                       |<----16 bits---->|
                                                       |---AH---|---AL---|
                                                                |<8 bits>|
```

- General purpose registers:
  - RAX - EAX - AX - AH, AL
  - RBX - EBX - BX - BH, BL
  - RCX - ECX - CX - CH, CL
  - RDX - EDX - DX - DH, DL
  - RSI - ESI - Source Index
  - RDI - EDI - Destination Index
  - R8, R9, R10, R11, R12, R13, R14, R15
- Another registers:
  - RSP - ESP - Stack Pointer (Top of stack)
  - RBP - EBP - Base Pointer (Base current stack frame)
  - RIP - EIP - Instruction Pointer (Next instruction)

### mov Instruction

- Sample program:

```assembly
global _start

_start:
    mov eax, 0x8
    mov ebx, eax
    mov ecx, [esp]
```

- Build and run GDB/GEF:

```bash
nasm test.asm -f elf64 -o mov.o
ld mov.o -o mov
gdb mov
```

- Set breakpoint with symbol:

```gdb
break _start
```

![breakpoint.png](./resource/breakpoint.png)

- You can also set breakpoint with address:

```gdb
break *0x401005
```

- And run:

![gdb_gef_interface.png](./resource/gdb_gef_interface.png)

- We have five main components:
  - registers: contains registers and their values.
  - stack: address & value.
  - code
  - threads
  - trace

- List all breakpoints:

```gdb
info breakpoints
```

![info_breakpoints.png](./resource/info_breakpoints.png)

- Continue program:

```gdb
continue
```

- Run next single step:

```gdb
si
```

- GDB short commands:
  - break -> b
  - run -> r
  - continue -> c
  - si -> Enter
  - etc.

### Access sub registers

- For example, you want to read `al` register, using `print` command:

```gdb
print $al
```

### ADD, SUB, INC, DEC instructions

```assembly
mov eax, 230
add eax, 1      # Add eax by 1.

mov eax, 230
sub eax, 1      # Sub eax by 1.

inc ebx         # Increase ebx by 1.
dec ebx         # Decrease ebx by 1.
```
